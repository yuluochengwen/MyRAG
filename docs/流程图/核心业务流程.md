## **核心业务流程**

**1. 知识库创建与文件处理：**

```
上传文件 → 计算MD5去重 → 文件解析(PyPDF2/python-docx) 
→ 文本分块(Recursive Text Splitter) → 向量化(Sentence-Transformers) 
→ 存储(ChromaDB + MySQL) → WebSocket实时进度推送
```

**2. RAG对话流程（支持上下文记忆）：**

```
用户查询 → 读取历史消息(max_history_turns*2) 
→ 向量检索(ChromaDB, top_k=5) → 构建增强Prompt 
→ LLM生成(INT4量化, 6GB显存优化) → 保存消息 → 返回结果
```

**3. 上下文记忆机制：**

- 从数据库读取最近N轮历史对话（按created_at DESC）
- 反转为时间正序传递给LLM
- Prompt优化：历史约定优先于RAG检索结果
- 支持动态调整记忆轮数（前端可配置）