# 知识图谱自动构建功能说明

## 修改内容

已在 `Backend/app/api/knowledge_base.py` 的 `process_file_background` 函数中添加了自动构建知识图谱的步骤。

## 工作流程

当文件上传到知识库后，系统会自动执行以下步骤：

1. **解析文件** (10%)
2. **文本分块** (30%)
3. **生成向量** (50%)
4. **存储向量** (80%)
5. **更新统计** 
6. **构建知识图谱** (90%) - **新增**
   - 自动从文本块提取实体和关系
   - 使用 Ollama 云端模型 (deepseek-v3.1:671b-cloud)
   - 增量添加到 Neo4j 图数据库
   - 不会强制重建现有图谱
7. **发送完成消息**

## 配置要求

确保 `Backend/config.yaml` 中：
```yaml
knowledge_graph:
  enabled: true  # ✅ 已启用
```

## 注意事项

1. **容错处理**：即使图谱构建失败，文件处理仍会继续完成
2. **增量构建**：使用 `force_rebuild=False`，不会删除现有图谱数据
3. **进度提示**：在前端会显示"正在构建知识图谱..."进度
4. **日志记录**：成功时记录实体数和关系数，失败时记录警告

## 测试方法

1. 重启后端服务以加载新代码
2. 上传新文件到知识库
3. 观察进度条显示"正在构建知识图谱..."
4. 查看知识库卡片上的图谱统计是否更新
5. 点击图谱统计查看详细信息

## 前提条件

- ✅ Neo4j 服务运行中 (bolt://localhost:7687)
- ✅ Ollama 服务运行中
- ✅ 已安装 deepseek-v3.1:671b-cloud 模型
- ✅ 知识图谱功能已启用

## 查看结果

上传文件后，可以通过以下方式查看图谱：

1. **前端知识库页面**：查看卡片上的图谱统计
2. **Neo4j Browser**：访问 http://localhost:7474
3. **API接口**：`GET /api/knowledge-bases/{kb_id}/graph/stats`
