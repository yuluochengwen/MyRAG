<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµå¼å“åº”å¯¹æ¯”æ¼”ç¤º</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">æµå¼å“åº” vs æ™®é€šå“åº”å¯¹æ¯”</h1>
        
        <div class="grid grid-cols-2 gap-6">
            <!-- æµå¼å“åº” -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-green-600">âœ… æµå¼å“åº”ï¼ˆå®æ—¶ï¼‰</h2>
                <div id="stream-output" class="min-h-[200px] bg-gray-50 p-4 rounded border border-gray-200 mb-4 whitespace-pre-wrap"></div>
                <button onclick="testStream()" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                    æµ‹è¯•æµå¼å“åº”
                </button>
                <p class="text-xs text-gray-500 mt-2">âœ¨ ç«‹å³å¼€å§‹æ˜¾ç¤ºï¼Œé€å­—è¾“å‡º</p>
            </div>
            
            <!-- æ™®é€šå“åº” -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-blue-600">â³ æ™®é€šå“åº”ï¼ˆç­‰å¾…ï¼‰</h2>
                <div id="normal-output" class="min-h-[200px] bg-gray-50 p-4 rounded border border-gray-200 mb-4 whitespace-pre-wrap"></div>
                <button onclick="testNormal()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                    æµ‹è¯•æ™®é€šå“åº”
                </button>
                <p class="text-xs text-gray-500 mt-2">â±ï¸ ç­‰å¾…å®Œæˆåä¸€æ¬¡æ€§æ˜¾ç¤º</p>
            </div>
        </div>
        
        <div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-6">
            <h3 class="font-bold mb-2 text-yellow-800">ğŸ’¡ æç¤º</h3>
            <ul class="text-sm space-y-1 text-yellow-700">
                <li>â€¢ ç‚¹å‡»ä¸¤ä¸ªæŒ‰é’®ï¼Œå¯¹æ¯”ä½“éªŒå·®å¼‚</li>
                <li>â€¢ æµå¼å“åº”ï¼šç«‹å³å¼€å§‹ï¼Œé€å­—æ˜¾ç¤ºï¼Œä½“éªŒæµç•…</li>
                <li>â€¢ æ™®é€šå“åº”ï¼šéœ€è¦ç­‰å¾…ï¼Œä¸€æ¬¡æ€§æ˜¾ç¤ºï¼Œé€‚åˆå¤åˆ¶å®Œæ•´å†…å®¹</li>
                <li>â€¢ å®é™…é¡¹ç›®ä¸­å·²é›†æˆå¼€å…³ï¼Œç”¨æˆ·å¯è‡ªç”±åˆ‡æ¢</li>
            </ul>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';
        
        // æ¨¡æ‹Ÿæ–‡æœ¬ï¼ˆå®é™…ä½¿ç”¨çœŸå®APIï¼‰
        const sampleText = `ä½ å¥½ï¼æˆ‘æ˜¯åä¸ºæ™ºèƒ½åŠ©æ‰‹ã€‚

æˆ‘åŸºäºåä¸ºå…¬å¸çš„çŸ¥è¯†åº“è¿›è¡Œè®­ç»ƒï¼Œå¯ä»¥å¸®åŠ©ä½ ï¼š

1. äº†è§£åä¸ºçš„ä¼ä¸šæ–‡åŒ–å’Œä»·å€¼è§‚
2. æŸ¥è¯¢å…¬å¸è§„ç« åˆ¶åº¦å’Œå‘˜å·¥å®ˆåˆ™
3. è·å–æŠ€æœ¯æ–‡æ¡£å’Œäº§å“ä¿¡æ¯
4. è§£ç­”æ—¥å¸¸å·¥ä½œä¸­çš„é—®é¢˜

æˆ‘ä½¿ç”¨äº†å…ˆè¿›çš„RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æŠ€æœ¯ï¼Œèƒ½å¤Ÿä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³å†…å®¹ï¼Œç„¶åç»“åˆAIå¤§æ¨¡å‹ç”Ÿæˆå‡†ç¡®ã€ä¸“ä¸šçš„å›ç­”ã€‚

å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶å¯ä»¥å‘æˆ‘æé—®ï¼`;

        async function testStream() {
            const output = document.getElementById('stream-output');
            output.textContent = '';
            
            // é€å­—æ˜¾ç¤º
            let index = 0;
            const interval = setInterval(() => {
                if (index < sampleText.length) {
                    output.textContent += sampleText[index];
                    index++;
                } else {
                    clearInterval(interval);
                }
            }, 30); // æ¯30msæ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦
        }
        
        async function testNormal() {
            const output = document.getElementById('normal-output');
            output.textContent = 'æ­£åœ¨ç”Ÿæˆå›ç­”...';
            
            // æ¨¡æ‹Ÿç­‰å¾…æ—¶é—´
            await new Promise(resolve => setTimeout(resolve, sampleText.length * 30));
            
            // ä¸€æ¬¡æ€§æ˜¾ç¤º
            output.textContent = sampleText;
        }
        
        // çœŸå®APIæµ‹è¯•ï¼ˆéœ€è¦æœ‰åŠ©æ‰‹å’Œå¯¹è¯ï¼‰
        async function testRealStream() {
            const output = document.getElementById('stream-output');
            output.textContent = '';
            
            try {
                // éœ€è¦å…ˆè·å–åŠ©æ‰‹IDå’Œåˆ›å»ºå¯¹è¯
                const response = await fetch(`${API_BASE_URL}/api/conversations/1/chat/stream`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: 'è¯·ç®€å•ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±',
                        temperature: 0.7
                    })
                });
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';
                    
                    for (const line of lines) {
                        if (!line.trim() || !line.startsWith('data: ')) continue;
                        
                        const jsonStr = line.substring(6);
                        const chunk = JSON.parse(jsonStr);
                        
                        if (chunk.type === 'text') {
                            output.textContent += chunk.data;
                        }
                    }
                }
            } catch (error) {
                output.textContent = 'é”™è¯¯: ' + error.message;
            }
        }
    </script>
</body>
</html>
