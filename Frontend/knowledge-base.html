<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çŸ¥è¯†åº“ç®¡ç† - RAGFlow.ai</title>
  <!-- å¼•å…¥Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- å¼•å…¥è‡ªå®šä¹‰æ ·å¼ -->
  <link rel="stylesheet" href="css/knowledge-base.css">
  
  <!-- Tailwindé…ç½® -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#69B1FF',
            accent: '#36CFC9',
            dark: '#1D2129',
            light: '#F2F3F5',
            danger: '#F53F3F',
            warning: '#FF7D00',
            success: '#00B42A'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
</head>
<body class="font-inter bg-gray-50 text-dark min-h-screen flex flex-col">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center py-4">
        <!-- Logo -->
        <div class="flex items-center space-x-2">
          <div class="w-10 h-10 rounded-lg bg-primary flex items-center justify-center">
            <i class="fa fa-link text-white text-xl"></i>
          </div>
          <span class="text-xl font-bold text-primary">RAGFlow<span class="text-dark">.ai</span></span>
        </div>
        
        <!-- å¯¼èˆªé“¾æ¥ - æ¡Œé¢ç‰ˆ -->
        <nav class="hidden md:flex items-center space-x-1">
          <a href="knowledge-base.html" class="nav-link nav-active px-4 py-2 font-medium border-b-2 transition-custom">çŸ¥è¯†åº“</a>
          <a href="intelligent-assistant.html" class="nav-link px-4 py-2 font-medium border-b-2 border-transparent hover:border-primary hover:text-primary transition-custom">æ™ºèƒ½åŠ©æ‰‹</a>
          <a href="agent.html" class="nav-link px-4 py-2 font-medium border-b-2 border-transparent hover:border-primary hover:text-primary transition-custom">Agent</a>
          <a href="model-management.html" class="nav-link px-4 py-2 font-medium border-b-2 border-transparent hover:border-primary hover:text-primary transition-custom">æ¨¡å‹ç®¡ç†</a>
        </nav>
        
        <!-- ç”¨æˆ·åŒºåŸŸ -->
        <div class="flex items-center space-x-4">
          <button class="p-2 rounded-full hover:bg-gray-100 transition-custom relative">
            <i class="fa fa-bell-o text-gray-600"></i>
            <span class="absolute top-1 right-1 w-2 h-2 bg-danger rounded-full"></span>
          </button>
          <div class="flex items-center space-x-2">
            <img src="https://picsum.photos/id/1005/40/40" alt="ç”¨æˆ·å¤´åƒ" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm">
            <span class="hidden md:inline font-medium">ç®¡ç†å‘˜</span>
          </div>
          <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
          <button class="md:hidden p-2 rounded-md hover:bg-gray-100 transition-custom" id="mobile-menu-btn">
            <i class="fa fa-bars text-gray-600"></i>
          </button>
        </div>
      </div>
      
      <!-- ç§»åŠ¨ç«¯å¯¼èˆªèœå• -->
      <div class="md:hidden hidden pb-4" id="mobile-menu">
        <nav class="flex flex-col space-y-2">
          <a href="knowledge-base.html" class="mobile-nav-link nav-active px-4 py-3 font-medium bg-primary/5 rounded-lg text-primary transition-custom">çŸ¥è¯†åº“</a>
          <a href="intelligent-assistant.html" class="mobile-nav-link px-4 py-3 font-medium hover:bg-gray-100 rounded-lg transition-custom">æ™ºèƒ½åŠ©æ‰‹</a>
          <a href="agent.html" class="mobile-nav-link px-4 py-3 font-medium hover:bg-gray-100 rounded-lg transition-custom">Agent</a>
          <a href="model-management.html" class="mobile-nav-link px-4 py-3 font-medium hover:bg-gray-100 rounded-lg transition-custom">æ¨¡å‹ç®¡ç†</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <main class="flex-grow container mx-auto px-4 py-6">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold">çŸ¥è¯†åº“ç®¡ç†</h1>
      <div class="flex space-x-3">
        <div class="relative">
          <input type="text" placeholder="æœç´¢çŸ¥è¯†åº“..." class="pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary w-full md:w-64 transition-custom">
          <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
        <button class="btn-filter px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-custom">
          <i class="fa fa-filter mr-2 text-gray-600"></i>
          <span class="hidden md:inline">ç­›é€‰</span>
        </button>
      </div>
    </div>
    
    <!-- çŸ¥è¯†åº“å¡ç‰‡ç½‘æ ¼ -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="kbList">
      <!-- åˆ›å»ºæ–°çŸ¥è¯†åº“å¡ç‰‡ -->
      <div class="bg-white rounded-xl p-6 card-shadow hover:shadow-lg transition-custom border-2 border-dashed border-gray-300 hover:border-primary cursor-pointer flex flex-col items-center justify-center text-center group" id="createKBCard">
        <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-4 group-hover:bg-primary/20 transition-custom">
          <i class="fa fa-plus text-primary text-2xl"></i>
        </div>
        <h3 class="text-lg font-bold mb-2">åˆ›å»ºçŸ¥è¯†åº“</h3>
        <p class="text-gray-500 mb-4">ä¸Šä¼ æ–‡æ¡£å¹¶åˆ›å»ºæ–°çš„çŸ¥è¯†åº“</p>
        <button class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-custom" id="createKBBtn">
          ç«‹å³åˆ›å»º
        </button>
      </div>
      
      <!-- åŠ¨æ€æ¸²æŸ“çš„çŸ¥è¯†åº“å¡ç‰‡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
    </div>
  </main>

  <!-- åˆ›å»ºçŸ¥è¯†åº“æ¨¡æ€æ¡† -->
  <div id="createKBModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-dark">åˆ›å»ºæ–°çŸ¥è¯†åº“</h2>
        <button id="closeModalBtn" class="p-2 rounded-lg hover:bg-gray-100 transition-custom">
          <i class="fa fa-times text-gray-400 text-xl"></i>
        </button>
      </div>
      
      <form id="createKBForm">
        <div class="mb-6">
          <label for="kbName" class="block text-sm font-medium text-gray-700 mb-2">
            çŸ¥è¯†åº“åç§° <span class="text-danger">*</span>
          </label>
          <input 
            type="text" 
            id="kbName" 
            name="name"
            required
            maxlength="100"
            placeholder="è¯·è¾“å…¥çŸ¥è¯†åº“åç§°ï¼ˆä»…æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦ï¼‰"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-custom"
          >
          <p class="mt-1 text-xs text-gray-500">1-100ä¸ªå­—ç¬¦</p>
        </div>
        
        <div class="mb-6">
          <label for="kbDescription" class="block text-sm font-medium text-gray-700 mb-2">
            æè¿°ä¿¡æ¯
          </label>
          <textarea 
            id="kbDescription" 
            name="description"
            rows="3"
            maxlength="500"
            placeholder="è¯·è¾“å…¥çŸ¥è¯†åº“æè¿°ï¼ˆå¯é€‰ï¼‰"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-custom resize-none"
          ></textarea>
          <p class="mt-1 text-xs text-gray-500">æœ€å¤š500ä¸ªå­—ç¬¦</p>
        </div>
        
        <div class="mb-6">
          <label for="embeddingProvider" class="block text-sm font-medium text-gray-700 mb-2">
            åµŒå…¥æä¾›æ–¹ <span class="text-danger">*</span>
          </label>
          <select 
            id="embeddingProvider" 
            name="embedding_provider"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-custom"
          >
            <option value="transformers" selected>ğŸ¤– Transformers (æœ¬åœ°æ¨¡å‹)</option>
            <option value="ollama">ğŸ¦™ Ollama (æœ¬åœ°æœåŠ¡)</option>
          </select>
          <p class="mt-1 text-xs text-gray-500">é€‰æ‹©åµŒå…¥æ¨¡å‹çš„æä¾›æ–¹</p>
        </div>
        
        <div class="mb-6">
          <label for="embeddingModel" class="block text-sm font-medium text-gray-700 mb-2">
            åµŒå…¥æ¨¡å‹ <span class="text-danger">*</span>
          </label>
          <select 
            id="embeddingModel" 
            name="embedding_model"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-custom"
          >
            <option value="">åŠ è½½ä¸­...</option>
          </select>
          <p class="mt-1 text-xs text-gray-500" id="modelHint">æ ¹æ®æä¾›æ–¹è‡ªåŠ¨åŠ è½½å¯ç”¨æ¨¡å‹</p>
        </div>
        
        <div class="flex space-x-3">
          <button 
            type="button" 
            id="cancelBtn"
            class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-custom font-medium"
          >
            å–æ¶ˆ
          </button>
          <button 
            type="submit" 
            class="flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-custom font-medium"
          >
            <i class="fa fa-check mr-2"></i>åˆ›å»º
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- æ–‡ä»¶åˆ—è¡¨æ¨¡æ€æ¡† -->
  <div id="filesModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[80vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-dark">æ–‡ä»¶åˆ—è¡¨</h2>
        <button onclick="closeFilesModal()" class="p-2 rounded-lg hover:bg-gray-100 transition-custom">
          <i class="fa fa-times text-gray-400 text-xl"></i>
        </button>
      </div>
      
      <div id="filesContent" class="space-y-3">
        <!-- åŠ¨æ€åŠ è½½æ–‡ä»¶åˆ—è¡¨ -->
      </div>
    </div>
  </div>

  <!-- æ–‡ä»¶å†…å®¹æ¨¡æ€æ¡† -->
  <div id="fileContentModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] hidden">
    <div class="bg-white rounded-2xl p-8 max-w-6xl w-full mx-4 shadow-2xl max-h-[90vh] flex flex-col">
      <div class="flex justify-between items-center mb-6">
        <div>
          <h2 class="text-2xl font-bold text-dark" id="fileContentTitle">æ–‡ä»¶å†…å®¹</h2>
          <p class="text-sm text-gray-500 mt-1" id="fileContentInfo"></p>
        </div>
        <button onclick="closeFileContentModal()" class="p-2 rounded-lg hover:bg-gray-100 transition-custom">
          <i class="fa fa-times text-gray-400 text-xl"></i>
        </button>
      </div>
      
      <div id="fileContentBody" class="flex-1 overflow-y-auto bg-gray-50 rounded-lg p-6">
        <!-- åŠ¨æ€åŠ è½½æ–‡ä»¶å†…å®¹ -->
      </div>
    </div>
  </div>

  <!-- æ–‡æœ¬å—æ¨¡æ€æ¡† -->
  <div id="chunksModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl max-w-6xl w-full mx-4 shadow-2xl max-h-[80vh] flex flex-col">
      <div class="flex justify-between items-center p-8 pb-4 border-b border-gray-200">
        <h2 class="text-2xl font-bold text-dark">æ–‡æœ¬å—è¯¦æƒ…</h2>
        <button onclick="closeChunksModal()" class="p-2 rounded-lg hover:bg-gray-100 transition-custom">
          <i class="fa fa-times text-gray-400 text-xl"></i>
        </button>
      </div>
      
      <div id="chunksContent" class="overflow-y-auto p-8 pt-4 space-y-3">
        <!-- åŠ¨æ€åŠ è½½æ–‡æœ¬å—åˆ—è¡¨ -->
      </div>
    </div>
  </div>

  <!-- çŸ¥è¯†å›¾è°±æ¨¡æ€æ¡† -->
  <div id="graphModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl max-w-6xl w-full mx-4 shadow-2xl max-h-[80vh] flex flex-col">
      <div class="flex justify-between items-center p-8 pb-4 border-b border-gray-200">
        <div>
          <h2 class="text-2xl font-bold text-dark">çŸ¥è¯†å›¾è°±</h2>
          <p class="text-sm text-gray-500 mt-1" id="graphKbName"></p>
        </div>
        <button onclick="closeGraphModal()" class="p-2 rounded-lg hover:bg-gray-100 transition-custom">
          <i class="fa fa-times text-gray-400 text-xl"></i>
        </button>
      </div>
      
      <div id="graphContent" class="overflow-y-auto p-8 pt-4">
        <!-- åŠ¨æ€åŠ è½½å›¾è°±è¯¦æƒ… -->
      </div>
    </div>
  </div>

  <script>
    // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
    document.getElementById('mobile-menu-btn')?.addEventListener('click', function() {
      document.getElementById('mobile-menu').classList.toggle('hidden');
    });

    // ä¸‹æ‹‰èœå•åŠŸèƒ½
    document.querySelectorAll('.dropdown button').forEach(button => {
      button.addEventListener('click', function(e) {
        e.stopPropagation();
        const menu = this.nextElementSibling;
        document.querySelectorAll('.dropdown-menu').forEach(m => {
          if (m !== menu) m.classList.add('hidden');
        });
        menu.classList.toggle('hidden');
      });
    });

    document.addEventListener('click', function() {
      document.querySelectorAll('.dropdown-menu').forEach(menu => {
        menu.classList.add('hidden');
      });
    });
  </script>

  <!-- å¼•å…¥è‡ªå®šä¹‰JavaScript -->
  <script src="js/common.js"></script>
  <script src="js/websocket.js"></script>
  <script src="js/knowledge-base.js"></script>
</body>
</html>
